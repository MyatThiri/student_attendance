<!DOCTYPE html>
<html lang="en">
  <head>
      <% include ../partial/head %>
    <title>Gentelella Alela! | </title>

  </head>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col">
          <div class="left_col scroll-view">
            <div class="navbar nav_title" style="border: 0;">
              <a href="index.html" class="site_title"><i class="fa fa-bell-o"></i> <span>SAM System</span></a>
            </div>

            <div class="clearfix"></div>

            <!-- menu profile quick info -->
            <% include ../partial/menu_profile %>
            <!-- /menu profile quick info -->

            <br />

            <!-- sidebar menu -->
            <% include ../partial/sidebar %>
            <!-- /sidebar menu -->

            <!-- /menu footer buttons -->
            <% include ../partial/menu_footer %>
            <!-- /menu footer buttons -->
          </div>
        </div>

        <!-- top navigation -->
        <% include ../partial/top_nav %>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>Draw Timetable</h3>
              </div>

            </div>
            <div class="clearfix"></div>

            <div class="row">
              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2><b>Timetable Info</b></h2>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">

                    <form action="/schedule/drawtimetable" method="post" name="frm" id="frm" class="form-horizontal form-label-left" novalidate>
                      <div class="item form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="dept">Department <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <select class="optional form-control col-md-7 col-xs-12" name="dept" id="dept">
                          </select>
                        </div>
                      </div>
                      <div class="item form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="tname">Teacher Name <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <select class="optional form-control col-md-7 col-xs-12" name="tname" id="tname" value="<%=timetable.name%>">
                            <option value="">Select department first...</option>
                          </select>
                        </div>
                      </div>
                      <div class="item form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="subj">Subject <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <select class="optional form-control col-md-7 col-xs-12" name="subj" id="subj" >
                            <option value="">Select teacher first...</option>
                          </select>
                        </div>
                      </div>
                      <div class="item form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="class">Class <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <select class="optional form-control col-md-7 col-xs-12" id="class" name="class" >
                            <option value="1BE">1BE</option>
                            <option value="2BE">2BE</option>
                            <option value="3BE">3BE</option>
                            <option value="4BE">4BE</option>
                            <option value="5BE">5BE</option>
                            <option value="6BE">6BE</option>
                          </select>
                        </div>
                      </div>

                    <div class="item form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="start">Start Time<span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <input id="start" type="time" value="<%=timetable.start_time%>" name="stime" data-validate-length-range="5,20" class="optional form-control col-md-7 col-xs-12">
                        </div>
                      </div>
                      <div class="item form-group">
                        <label for="password" class="control-label col-md-3">End Time<span class="required">*</span></label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <input id="end" type="time" value="<%=timetable.end_time%>" name="etime" data-validate-length="5,20" class="form-control col-md-7 col-xs-12" required="required">
                        </div>
                      </div>
                      <div class="item form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="date">Date <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <select class="optional form-control col-md-7 col-xs-12" id="date" name="date">
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                          </select>
                        </div>
                      </div>
                      <div class="ln_solid"></div>
                      <div class="form-group">
                        <div class="col-md-6 col-md-offset-3">
                          <button id="send" type="submit" class="btn btn-success">Modify</button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <% include ../partial/footer %>
        <!-- /footer content -->
      </div>
    </div>

    <% include ../partial/script %>

  </body>
  <!-- bootstrap-daterangepicker -->
  <script src="/vendors/moment/min/moment.min.js"></script>
  <script src="/vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
  <!-- bootstrap-datetimepicker -->
  <script src="/vendors/bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>

  <script>

      $('#datetimepicker6').datetimepicker();

      $('#datetimepicker7').datetimepicker({
          useCurrent: false
      });

      $("#datetimepicker6").on("dp.change", function(e) {
          $('#datetimepicker7').data("DateTimePicker").minDate(e.date);
      });

      $("#datetimepicker7").on("dp.change", function(e) {
          $('#datetimepicker6').data("DateTimePicker").maxDate(e.date);
      });

      var tb = [];
      var $dept = $("#dept");
      $dept.append(new Option("Select dept",  ""));
      <%for(var dept of depts){%>
        $dept.append(new Option("<%=dept.dept_name%>",  "<%=dept.dept_id%>"));
      <%}%>
      <%for(var i in teachers){%>
        tb.push({dept:"<%=teachers[i].dept_id%>",tname:"<%=teachers[i].name%>",subj:"<%=teachers[i].subj_name%>"});
      <%}%>

      console.log(typeof tb);
      function changeDept(){
        var tb2 = $.grep(tb, function(n,i){
          return n.dept == $("#dept").val();
        });
        addOptions('tname',tb2); // add teachers
        clearOptions('subj', 'Select teacher first...');
      }
      function changeTeacher(){
        var tb2 = $.grep(tb, function(n,i){
          return n.dept == $("#dept").val() && n.tname == $("#tname").val();
        });
          addOptions('subj',tb2); //  add subjects
      }

        $("#dept").on('change', changeDept);

        $("#tname").on('change', changeTeacher);

        function addOptions(id,arr){
          clearOptions(id);
          for(var idx in arr){
            if(idx == 0) $("#"+id).append(new Option('Select '+((id=="dept")? "Department":((id=="tname")? "Teacher": "Subject")), ''));
            if(idx == 0 || arr[idx][id] != arr[idx-1][id]){
              $("#"+id).append(new Option((id=='dept')? change(arr[idx][id]):arr[idx][id], arr[idx][id]));
            }
          }
        }
        function clearOptions(id, msg){
          $("#"+id).children().remove();
          if(msg){
            $("#"+id).append(new Option(msg,""));
          }
        }

        $('#class').val("<%=timetable.class%>").change();
        $('#date').val("<%=timetable.date_id%>").change();

        $dept.val('<%=timetable.dept_id%>');
        changeDept();
        $("#tname").val('<%=timetable.name%>');
        changeTeacher();
        $("#subj").val('<%=timetable.subj_name%>');
  </script>
</html>
